#!/bin/sh

EXIT=0
DIR="$1"
shift

mkfifo filenames
find "${DIR}" -type f \( -iname \*.cpp -or -iname \*.hpp -or -iname \*.c -or -iname \*.h \) > filenames &
while read -r filename; do
    if ! clang-format "$@" "${filename}" | diff -u "${filename}" -; then
        EXIT=1
    fi
done < filenames
rm filenames

exit ${EXIT}
